{
  "version": 3,
  "sources": ["../../../../Documents/C%C3%93DIGOS PYTHON/pythonProject/novo_crv_disc/netlify/functions/foto.js"],
  "sourceRoot": "C:/Users/Victor/AppData/Local/Temp/tmp-16168-osv97SOKQelV",
  "sourcesContent": ["// ============================================================================\r\n// FOTO DO DIA \u2014 NETLIFY FUNCTION (v4 FINAL)\r\n// Fluxo: Pexels \u2192 Unsplash \u2192 Pixabay \u2192 fallback\r\n// Sempre retorna 1 foto v\u00E1lida e profissional para o dashboard\r\n// Usa vari\u00E1veis do Netlify (.env)\r\n// ============================================================================\r\n\r\nconst PEXELS_API_KEY = process.env.PEXELS_API_KEY;\r\nconst UNSPLASH_KEY = process.env.UNSPLASH_KEY;\r\nconst PIXABAY_KEY = process.env.PIXABAY_KEY;\r\n\r\n// Temas profissionais rotativos\r\nconst temas = [\r\n  \"business teamwork office\",\r\n  \"leadership people meeting\",\r\n  \"corporate communication team\",\r\n  \"diversity inclusion office\",\r\n  \"career development workplace\",\r\n  \"technology innovation office\",\r\n  \"strategy leadership meeting\"\r\n];\r\n\r\n// Tema do dia (varia\u00E7\u00E3o est\u00E1vel)\r\nfunction temaDoDia() {\r\n  const index = new Date().getDay();\r\n  return temas[index % temas.length];\r\n}\r\n\r\n// ============================================================================\r\n// CACHE \u2013 Reinicia diariamente\r\n// ============================================================================\r\nlet CACHE_FOTO = null;\r\nlet CACHE_DATA = null;\r\n\r\nfunction cacheValido() {\r\n  return CACHE_FOTO && CACHE_DATA === new Date().toDateString();\r\n}\r\n\r\n// ============================================================================\r\n// PEXELS\r\n// ============================================================================\r\nasync function buscarPexels(query) {\r\n  try {\r\n    if (!PEXELS_API_KEY) return null;\r\n\r\n    const res = await fetch(\r\n      `https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&per_page=1&orientation=landscape`,\r\n      {\r\n        headers: {\r\n          Authorization: PEXELS_API_KEY\r\n        }\r\n      }\r\n    );\r\n\r\n    if (!res.ok) return null;\r\n    const data = await res.json();\r\n    if (!data.photos?.length) return null;\r\n\r\n    const foto = data.photos[0];\r\n\r\n    return {\r\n      url: foto.src.large2x || foto.src.large,\r\n      autor: foto.photographer,\r\n      fonte: \"Pexels\",\r\n      link: foto.url\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// UNSPLASH\r\n// ============================================================================\r\nasync function buscarUnsplash(query) {\r\n  try {\r\n    if (!UNSPLASH_KEY) return null;\r\n\r\n    const res = await fetch(\r\n      `https://api.unsplash.com/photos/random?query=${encodeURIComponent(query)}&orientation=landscape&client_id=${UNSPLASH_KEY}`\r\n    );\r\n\r\n    if (!res.ok) return null;\r\n    const foto = await res.json();\r\n\r\n    if (!foto?.urls) return null;\r\n\r\n    return {\r\n      url: foto.urls.regular,\r\n      autor: foto.user?.name || \"Autor desconhecido\",\r\n      fonte: \"Unsplash\",\r\n      link: foto.links?.html || \"#\"\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// PIXABAY\r\n// ============================================================================\r\nasync function buscarPixabay(query) {\r\n  try {\r\n    if (!PIXABAY_KEY) return null;\r\n\r\n    const res = await fetch(\r\n      `https://pixabay.com/api/?key=${PIXABAY_KEY}&q=${encodeURIComponent(query)}&image_type=photo&orientation=horizontal&per_page=5`\r\n    );\r\n\r\n    if (!res.ok) return null;\r\n\r\n    const data = await res.json();\r\n    if (!data.hits?.length) return null;\r\n\r\n    const foto = data.hits[0];\r\n\r\n    return {\r\n      url: foto.largeImageURL,\r\n      autor: foto.user,\r\n      fonte: \"Pixabay\",\r\n      link: foto.pageURL\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// FALLBACK SE TUDO DER ERRADO\r\n// ============================================================================\r\nfunction fallbackFoto() {\r\n  return {\r\n    url: \"https://images.unsplash.com/photo-1556761175-129418cb2dfe?w=1200\",\r\n    autor: \"Banco de Imagens\",\r\n    fonte: \"Fallback\",\r\n    link: \"https://unsplash.com\"\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// HANDLER \u2014 Netlify padr\u00E3o\r\n// ============================================================================\r\nexports.handler = async () => {\r\n  try {\r\n    if (cacheValido()) {\r\n      return {\r\n        statusCode: 200,\r\n        body: JSON.stringify(CACHE_FOTO)\r\n      };\r\n    }\r\n\r\n    const query = temaDoDia();\r\n\r\n    const foto =\r\n      (await buscarPexels(query)) ||\r\n      (await buscarUnsplash(query)) ||\r\n      (await buscarPixabay(query)) ||\r\n      fallbackFoto();\r\n\r\n    CACHE_FOTO = foto;\r\n    CACHE_DATA = new Date().toDateString();\r\n\r\n    return {\r\n      statusCode: 200,\r\n      body: JSON.stringify(foto)\r\n    };\r\n  } catch (e) {\r\n    return {\r\n      statusCode: 500,\r\n      body: JSON.stringify(fallbackFoto())\r\n    };\r\n  }\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
